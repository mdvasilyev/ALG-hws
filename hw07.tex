\section{Демоническое программирование}

% \subsection{Практика}
% \begin {enumerate}
%   \item
%     Найдите максимальную возрастающую подпоследовательность за
%     $\O(n \log{n})$. Подсказка: используйте дополнительный массив, в котором
%     на $i$-той позиции стоит минимальный элемент, на который
%     оканчивается некоторая возрастающая подпоследовательность длины
%     $i$.

%   \item
%     Даны две последовательности длины $n$. Придумайте, как найти
%     наидлиннейшую общую подпоследовательность этих последовательностей.
%     \begin{enumerate}
%       \item За $\O(n^2)$.
%       \item
%         За $\O(n \log n)$, в случае, если в одной из последовательностей
%         все элементы различны.
%     \end{enumerate}

%   \item
%     Даны $n$ предметов. У каждого заданы целый вес $w_i$ и цена $v_i$. Найти $\max$ цену,
% 	которую можно набрать предметами суммарного веса $\le S$. Время $\O(nS)$, память $\O(S)$.
% 	\begin{enumerate}
% 		\item Каждый предмет можно брать один раз.
% 		\item Каждый предмет можно брать сколько угодно раз.
% 		\item Каждый предмет можно брать сколько угодно раз. Восстановить ответ.
% 		\item Каждый предмет можно брать один раз + набрать ровно $S$. Цен нет. Восстановить ответ.
% 		\item \textbf{(*)} Каждый предмет можно брать один раз + набрать ровно $S$. Восстановить ответ.
% 	\end{enumerate}

%   \item
% 	Дано рекуррентное соотношение:
%     \begin{enumerate}
% 	  \item
% 		$$\begin{matrix}
% 		a_n = a_{n - 1} + 2b_{n - 1} \\
% 		b_n = 10b_{n - 1} - a_{n - 1} 
% 		\end{matrix}$$

% 	  \item 		
% 		$$\begin{matrix}
% 		a_n = a_{n - 1} + 2c_{n - 1} + 1 \\
% 		b_n = 5 - c_{n - 1} \\
% 		c_n = c_{n - 2} - b_{n - 1}
% 		\end{matrix}$$
% 	\end{enumerate}
% 	Известны $a_0, a_1, b_0, b_1, c_0, c_1$.
% 	Найти $a_n, b_n, c_n$ по модулю $p$ за $\O(\log n)$.

%   \item
% 	Дан выпуклый $n$-угольник. Каждая диагональ $n$-угольника,
% 	соединяющая вершины $i$ и $j$, имеет вес $w_{ij}$. Вес
% 	триангуляции многоугольника есть сумма весов диагоналей, которые
% 	в ней проведены. Найти триангуляцию с минимальным весом за
% 	$\O(n^3)$.

%   \item
%     Судно атакуют пираты. Для каждого пирата известны его азимут $a_i$
%     и время $t_i$, через которое пират приплывет и совершит
%     непотребство. Однако, у судна есть лазерная пушка, которой оно
%     защищается. У пушки есть начальный азимут $a$ и угловая скорость
%     вращения $\omega$. Пушка уничтожает все объекты, на которые она
%     сейчас направлена. Помогите судну определить порядок уничтожения
%     пиратов за $\O(n^2)$, чтобы не допустить непотребства.

%   \item
% 	Шаблоном будем называть строку, состоящую из букв латинского алфавита и символов ``\texttt{?}'' и ``\texttt{*}''.
% 	Будем говорить, что строка $s$ подходит под шаблон $p$, если в $p$ можно заменить каждый символ \texttt{?}
% 	на букву и каждый символ \texttt{*} на строку из латинских букв (возможно, пустую) так, что результат
% 	будет равен $s$. Для строки $s$ и шаблона $p$ определите, подходит ли строка под шаблон за $\O(|s| \cdot |p|)$.
% 	Подсчитайте количество способов, которыми строка подходит под шаблон.

% \subsection*{Дополнительные задачи}

%   \item
% 	Даны два шаблона $a$ и $b$, состоящие из букв латинского алфавита и символов ``\texttt{?}'' и ``\texttt{*}''.
% 	Найдите какое-либо слово минимальной длины, подходящее под оба шаблона, за время $\O(|a| \cdot |b|)$.

% \end{enumerate}

% \newpage

\subsection{Домашнее задание}

\begin{enumerate}

  \item \exceptgroup{Мишунина}
    Даны две последовательности длины $n$. В одной из последовательностей все элементы различны. Найдите
    их наидлиннейшую общую подпоследовательность за $\O(n \log n)$. 
	\begin{solution}
    Создадим хэш таблицу (за $\O(n)$) от строки, в которой нет повторяющихся элементов. Она будет в качестве ключей хранить значения последовательности, а в качестве значений -- индексы этих значений. Начнем итерироваться по элементам другой последовательности и будем заполнять массив $a$, в котором будут храниться индексы из заготовленной хэш таблицы. Заполнять массив будем по следующему правилу: значение $idx$ $i$-го элемента массива $a$ должно быть таким, что:
    \begin{equation}
        a[k-1] < idx < a[k].
    \end{equation}
    Получается, что массив $a$ заполняется таким образом, что он в любой момент времени отсортирован и для того, чтобы найти подходящий $k$, можно воспользоваться бинарным поиском (за $\O(\log n)$). В момент обновления элемента массива $a$ мы будем добавлять соответствующий индексу $idx$ элемент последовательности к нашей искомой наидлиннейшей общей подпоследовательности. На выходе получаем подпоследовательность и ее длину. Корректность: мы заполняли массив индексами строки, в которых происходил скачек значения. Асимптотика: $\O(n+m)\cdot \log n$, где $m$ -- количество совпадений в строках, которое в нашем случае максимум $n$, т.к. в одной строке все символы различны, поэтому итоговая асимптотика
    \begin{equation}
      \O(n+n)\cdot \log n = \O(n \log n).
    \end{equation} 
	\end{solution}

  \item \exceptgroup{Мишунина} Дано рекуррентное соотношение:
    $$\begin{matrix}
    a_n = a_{n - 1} + 2c_{n - 1} + 1 \\
    b_n = 5 - c_{n - 1} \\
    c_n = c_{n - 2} - b_{n - 1}
    \end{matrix}$$
    Известны $a_0, a_1, b_0, b_1, c_0, c_1$.
    Найдите $a_n, b_n, c_n$ по модулю $p$ за $\O(\log n)$.
  \begin{solution}
    Запишем в матричной форме:
    \begin{equation}
      \begin{pmatrix}
        a_n \\
        b_n \\
        c_n \\
        0 \\
        0
      \end{pmatrix} =
      \begin{pmatrix}
        1 & 0 & 2 & 0 & 1\\ 
        0 & 0 & -1 & 0 & 5\\ 
        0 & -1 & 0 & 1 & 0\\
        0 & 0 & 0 & 0 & 0\\ 
        0 & 0 & 0 & 0 & 0\\ 
      \end{pmatrix} \cdot
      \begin{pmatrix}
        a_{n-1} \\
        b_{n-1} \\
        c_{n-1} \\
        c_{n-2} \\
        1
      \end{pmatrix} =
      \begin{pmatrix}
        1 & 0 & 2 & 0 & 1\\ 
        0 & 0 & -1 & 0 & 5\\ 
        0 & -1 & 0 & 1 & 0\\ 
        0 & 0 & 0 & 0 & 0\\ 
        0 & 0 & 0 & 0 & 0\\ 
      \end{pmatrix}^{n-1} \cdot
      \begin{pmatrix}
        a_{1} \\
        b_{1} \\
        c_{1} \\
        c_{0} \\
        1
      \end{pmatrix}
    \end{equation}
    Используем быстрое возведение в степень для матриц. Отсюда и асимптотика $\O(\log n)$.
  \end{solution}
    
  \item
    Дана строка $s$ длины $n$. Для каждой пары $(i, j)$ найти длину максимального
    общего префикса $i$-го и $j$-го суффиксов строки $s$. $\O(n^2)$.

  \item
    Дан набор нечестных монеток с вероятностью выпадения орла
    $p_1, p_2, \dots, p_n$. Требуется посчитать вероятность выпадения
    ровно $k$ орлов за $\O(n \cdot k)$. Операции над числами считать 
    выполнимыми за $\O(1)$.
  \begin{solution}
    Решим через динамику. Заведем матрицу $dp[i][j]$, в которой будет записано, вероятность выпадения $i$ орлов среди первых $j$ бросков. Заполним в этой таблице базу: $dp[0][0] = 1$ -- вероятность выкинуть 0 орлов среди 0 бросков; можно заполнить диагональ: $dp[1][1] = p_1$, $dp[2][2] = p_1*p_2$, $dp[3][3] = p_1*p_2*p_3$, ...; можно заполнить все, что ниже диагонали -- там нули, потому что нельзя выбросить больше орлов, чем всего бросков произведено; и еще можно заполнить всю первую строчку, где выбросить 0 орлов среди скольки-то бросков: $dp[0][1] = (1-p_1)$, $dp[0][2] = (1-p_1)*(1-p_2)$, $dp[0][3] = (1-p_1)*(1-p_2)*(1-p_3)$, ... . Запишем переход: $dp[i][j] = dp[i-1][j](1-p[i])+dp[i-1][j-1]p[i]$ -- означает, что мы либо на предыдущем шаге набрали нужное количество орлов, поэтому на данном шаге нужно выкинуть решку, либо нам нужно на этом шаге выбросить орла в противном случае. Получается, что мы заполняем эту матрицу сверху слева вправо вниз. Чтобы вычислить текущую клетку нам нужна клетка левее и левее выше. База нам это обеспечила. Мы корректно заполняем таблицу и получаем корректный ответ в правом нижнем углу (выше блока нулей). Асимптотика: заполняем матрицу размеров $n\cdot k \Rightarrow \O(n\cdot k)$
  \end{solution}

%   \item \onlygroup{Мишунина} \textbf{LZSS}\\
% 	Дана строка из латинских букв длины $n$, нужно ее запаковать в максимально короткую,
% 	используя правило $(k, i)$ --- повторить $k$ символов начиная с $i$-й позиции.
% 	Заметим, что длина $(k, i)$ -- не константа.
% 	Например, $xyabababababz \rightarrow xyab(8,2)z$, $xyaaaabaaaabaaaab \rightarrow xya(3,2)b(10,2)$
% 	(но это не оптимально, оптимально $xyaaaab(10,2)$).
% 	\begin{enumerate}
% 		\item $\O(n^3)$.
% 		\item $\O(n^2)$, считая, что длина строки $(k, i)$ -- константа.
% 		\item $\O(n^2)$.
% 	\end{enumerate}

  \item[6.] 
 	Пусть есть $n$ подарков разной натуральной стоимости и три поросёнка. Нужно
    раздать подарки как можно честнее (так, чтобы минимизировать
    разность суммарной стоимости подарков самого везучего поросёнка и
    самого невезучего). Придумайте алгоритм решения данной задачи за
    $\O(nW^2)$, где $W$ --- суммарная стоимость подарков.

  \item[7.]
	Шаблоном будем называть строку, состоящую из букв латинского алфавита и символов ``\texttt{?}'' и ``\texttt{*}''.
	Будем говорить, что строка $s$ подходит под шаблон $p$, если в $p$ можно заменить каждый символ \texttt{?}
	на букву и каждый символ \texttt{*} на строку из латинских букв (возможно, пустую) так, что результат
	будет равен $s$. Для строки $s$ и шаблона $p$ определите, подходит ли строка под шаблон за $\O(|s| \cdot |p|)$.

% \subsection*{Дополнительные задачи}    

%   \item
% 	У профессора есть $k$ яиц и $n$ этажное здание.
% 	Он хочет узнать максимальное $x$: если яйцо бросить с $x$-го этажа, оно не разобьётся.
% 	Не разбившиеся яйца можно переиспользовать. Минимизировать число бросков в худшем случае.
% 	\begin{enumerate}
% 	  \item $\O(n^2 k)$.
% 	  \item $\O(n k \log{n})$.
% 	  \item $\O(n k)$.
% 	  \item $\O(n \log{n})$.
% 	\end{enumerate}

\end{enumerate}
