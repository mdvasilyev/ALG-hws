\section{Кратчайшие пути}

% \subsection{Практика}
% \begin{enumerate}
%   \item
%     Дан орграф с положительными весами на ребрах. Найти кратчайший путь, проходящий по всем $k$ выделенным вершинам. 
%     Время $\O(2^k E \log{(2^k V)})$.

%   \item
%     Пусть даны $n$ валют и $m$ обменников, и $i$-й обменник предлагает менять
%     валюту $a_i$ на валюту $b_i$ по курсу $c_i/d_i$.  
%     Приведите алгоритм, определяющий за время $\O(nm)$, возможно ли бесконечно обогащаться.
%     Другими словами, существуют ли такие $p, q, s \: (p < q)$, что, имея $p$ единиц валюты типа $s$, 
%     можно за несколько обменных операций получить хотя бы $q$ единиц валюты типа $s$?
%     Считайте, что у обменников есть бесконечное количество денег
%     целевой валюты.

%   \item
%     Пусть дан взвешенный граф $G$ (возможно, с циклами отрицательного веса). На
%     вершинах этого графа определим функцию $\phi(v)$ --- потенциал.
%     Заменим вес каждого ребра $w(u, v)$ на $w'(u,v) = w(u, v) + \phi(u) - \phi(v)$.
%     Докажите, что кратчайшим путям между двумя вершинами в
%     графе с весами $w'$ будут однозначно соответствовать кратчайшие пути в графе с
%     весами $w$.

%   \item
%     Пусть во взвешенном графе $G$ нет циклов отрицательной
%     стоимости. Докажите, что если в качестве потенциала взять
%     кратчайшее расстояние от некоторой вершины $s$, то все веса $w'$
%     получатся неотрицательными (если соответствующие расстояния конечны).

%   \item
%     Дана система из $m$ неравенств на $n$ переменных $x_i$. Каждое
%     неравенство имеет вид $x_j - x_i \leq \delta_{ij}$.
%     \begin{enumerate}
%       \item Найти решение системы или сказать, что его не существует, за $\O(n \cdot m)$.
%       \item Пусть все $\delta_{ij} \ge 0$, решить задачу за $o(n \cdot m)$.
%     \end{enumerate}

%   \item
%     Дан произвольный взвешенный орграф, найдите расстояние от $a$ до $b$
%     (число или $\pm \infty$). $\O(V E)$.

%   \item
%     Предподсчёт за $\O(V^3)$ и запрос $\langle a, b, e \rangle$ за
%     $\O(1)$ --- существует ли кратчайший путь из $a$ в $b$, проходящий
%     через ребро $e$?

%   \item
%     Для каждой вершины графа узнать, есть ли отрицательный цикл через
%     эту вершину. $\O(V^3)$.

%   \item
%     Для каждой пары вершин в графе найти $w[a,b]$ -- такой минимальный
%     вес, что из $a$ в $b$ есть путь по рёбрам, вес которых не больше
%     $w[a,b]$. $\O(V^3)$.

%   \item
%     Нужно научиться на запрос ``уменьшился вес ребра'' за $\O(V^2)$
%     пересчитывать матрицу расстояний. Считайте, что в графе не было и не появилось отрицательных циклов.

%   \item
%     Рассмотрим граф, на каждом ребре которого написан нолик или единица.
%     Каждому пути в этом графе соответствует некоторая бинарная
%     строка. Строки сравниваются как двоичные числа (старшие разряды слева),
%     среди одинаковых чисел меньше то, у которого меньше ведущих нулей.
%     Для задачи нахождения кратчайших путей относительно такой метрики докажите
%     корректность или приведите контрпример для алгоритма
%     \begin{enumerate}
%       \item Флойда
%       \item Дейкстры
%       \item Беллмана-Форда
%     \end{enumerate}

% \end{enumerate}

% \newpage
\subsection{Домашнее задание}
\begin{enumerate}
  \item
    Дан взвешенный неориентированный граф $G = \langle V, E \rangle$ с положительными весами.
    В графе есть подмножество вершин $T \subset V$, которые мы назовем терминалами.
    Минимальное дерево Штейнера --- это связный подграф графа $G$ минимального веса, содержащий
    все терминалы.
    \begin{enumerate}
      \item
        Пусть граф полный, и все веса удовлетворяют неравенству треугольника $c_{ij} + c_{jk} \geq c_{ik}$.
        Найдите дерево Штейнера, которое не больше, чем в 2 раза превышает размер минимального,
        (т.е. 2-приближение) за $\O(V^2)$.
      \item
        Пусть граф связный, но неравенства треугольника нет. Найдите 2-приближение за $\O(V^3)$.
    \end{enumerate}

  \item
    Пусть на вершинах графа задан порядок: $v_1, v_2, \cdots, v_n$.
    Пусть алгоритм Беллмана-Форда на каждой стадии рассматривает
    ребра в таком порядке: сначала ребра, ведущие из меньшей вершины в
    большую (в порядке возрастания исходящей вершины), а потом ребра,
    ведущие из большей вершины в меньшую (в порядке убывания исходящей
    вершины). Докажите, что если в графе нет циклов отрицательного
    веса, то алгоритм найдет все кратчайшие пути из $v_1$ за $\frac{n}{2}$
    стадий.
    \begin{solution}
      Если уже известен кратчайший путь от исходной вершины до $i$-ой вершины, то на очередной стадии, этот алгоритм, рассмотрев ребра из $v_i$ в $v_j$, определит кратчайшее расстояние до $v_j$.
      Теперь посмотрим, как получается кратчайшее расстояние от исходной вершины до $v_i$. Понятно, что кратчайший путь до нее будет состоять из последовательности вершин, каждая из которых присутствует не более одного раза, так как циклов отрицательного веса нет. Любая часть этой последовательности является кратчайшим путем до очередной вершины и может быть разбита на отрезки монотонного возрастания и убывания индексов вершин. В связи с этим такой алгоритм Беллмана-Форда будет за одну стадию обрабатывать одну возрастающую и одну убывающую последовательность в том же порядке, в котором они следуют во всей последовательности. В итоге после одной стадии будет найден кратчайший путь до последней вершины первого промежутка убывания вершин $v_j$. Худший случай -- когда вершины чередуются (т.е. промежутки возрастания и убывания по единичной длине). И в худшем случае задача сокращается хотя бы на 2 вершины за 1 стадию, ведь остается рассмотреть ребра кратчайшего пути от $v_j$ до $v_i$. Поэтому, если предположить, что длина кратчайшего пути $n$, то за $\frac{n}{2}$ стадий алгоритм найдет кратчайшие пути из $v_1$ до любых $v_i$.
    \end{solution}

  \item
    Дан взвешенный орграф $(V, E)$, посчитайте от начальной вершины $s$ до всех остальных
    кратчайшие расстояния относительно метрики:
    \begin{enumerate}
      \item <<вес самого \texttt{тяжелого} ребра на пути>>. $\O(E \log{V})$. \\
        \textit{(Подсказка: модифицируйте алгоритм Дейкстры и докажите, что он работает)}
      \item <<вес самого \texttt{легкого} ребра на пути>>. $\O(V + E)$.
    \end{enumerate}

% \subsection*{Дополнительные задачи}

%   \item
%     Докажите для задачи 2 оценку $\frac{n}{3}$ в среднем, если вершины пронумерованы случайной перестановкой.

\end{enumerate}

